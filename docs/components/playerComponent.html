<!DOCTYPE html>

<html>

<head>
  <title>
    Classe *PlayerComponent*
  </title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>

<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
            <div id="jump_page_wrapper">
              <div id="jump_page">
                
                  
                    <a class="source" href="../chickendodge.html">
                      chickendodge.js
                    </a>
                    
                  
                    <a class="source" href="../components.html">
                      components.js
                    </a>
                    
                  
                    <a class="source" href="backgroundLoaderComponent.html">
                      components/backgroundLoaderComponent.js
                    </a>
                    
                  
                    <a class="source" href="cameraComponent.html">
                      components/cameraComponent.js
                    </a>
                    
                  
                    <a class="source" href="chickenComponent.html">
                      components/chickenComponent.js
                    </a>
                    
                  
                    <a class="source" href="chickenSpawnerComponent.html">
                      components/chickenSpawnerComponent.js
                    </a>
                    
                  
                    <a class="source" href="colliderComponent.html">
                      components/colliderComponent.js
                    </a>
                    
                  
                    <a class="source" href="component.html">
                      components/component.js
                    </a>
                    
                  
                    <a class="source" href="compositorComponent.html">
                      components/compositorComponent.js
                    </a>
                    
                  
                    <a class="source" href="countdownComponent.html">
                      components/countdownComponent.js
                    </a>
                    
                  
                    <a class="source" href="debugDrawCallsComponent.html">
                      components/debugDrawCallsComponent.js
                    </a>
                    
                  
                    <a class="source" href="deformationCompositorComponent.html">
                      components/deformationCompositorComponent.js
                    </a>
                    
                  
                    <a class="source" href="enablerComponent.html">
                      components/enablerComponent.js
                    </a>
                    
                  
                    <a class="source" href="heartComponent.html">
                      components/heartComponent.js
                    </a>
                    
                  
                    <a class="source" href="inputComponent.html">
                      components/inputComponent.js
                    </a>
                    
                  
                    <a class="source" href="layerComponent.html">
                      components/layerComponent.js
                    </a>
                    
                  
                    <a class="source" href="lifeComponent.html">
                      components/lifeComponent.js
                    </a>
                    
                  
                    <a class="source" href="playerComponent.html">
                      components/playerComponent.js
                    </a>
                    
                  
                    <a class="source" href="positionComponent.html">
                      components/positionComponent.js
                    </a>
                    
                  
                    <a class="source" href="rawSpriteComponent.html">
                      components/rawSpriteComponent.js
                    </a>
                    
                  
                    <a class="source" href="rectangle.html">
                      components/rectangle.js
                    </a>
                    
                  
                    <a class="source" href="refereeComponent.html">
                      components/refereeComponent.js
                    </a>
                    
                  
                    <a class="source" href="renderCompositorComponent.html">
                      components/renderCompositorComponent.js
                    </a>
                    
                  
                    <a class="source" href="rupeeComponent.html">
                      components/rupeeComponent.js
                    </a>
                    
                  
                    <a class="source" href="scoreComponent.html">
                      components/scoreComponent.js
                    </a>
                    
                  
                    <a class="source" href="spriteComponent.html">
                      components/spriteComponent.js
                    </a>
                    
                  
                    <a class="source" href="spriteSheetComponent.html">
                      components/spriteSheetComponent.js
                    </a>
                    
                  
                    <a class="source" href="textSpriteComponent.html">
                      components/textSpriteComponent.js
                    </a>
                    
                  
                    <a class="source" href="textureComponent.html">
                      components/textureComponent.js
                    </a>
                    
                  
                    <a class="source" href="timerComponent.html">
                      components/timerComponent.js
                    </a>
                    
                  
                    <a class="source" href="../eventTrigger.html">
                      eventTrigger.js
                    </a>
                    
                  
                    <a class="source" href="../graphicsAPI.html">
                      graphicsAPI.js
                    </a>
                    
                  
                    <a class="source" href="../main.html">
                      main.js
                    </a>
                    
                  
                    <a class="source" href="../scene.html">
                      scene.js
                    </a>
                    
                  
                    <a class="source" href="../sceneObject.html">
                      sceneObject.js
                    </a>
                    
                  
                    <a class="source" href="../utils.html">
                      utils.js
                    </a>
                    
              </div>
            </div>
        </li>
      </ul>
      
        <ul class="sections">
          
              
                
                  <li id="section-1">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-1">&#182;</a>
                        </div>
                        
                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>define([
  <span class="hljs-string">'components/component'</span>,
  <span class="hljs-string">'eventTrigger'</span>,
], (
  Component,
  EventTrigger
) =&gt; {
  <span class="hljs-string">'use strict'</span>;

  <span class="hljs-keyword">const</span> vec3 = <span class="hljs-built_in">window</span>.vec3;</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-2">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-2">&#182;</a>
                        </div>
                        <h1 id="classe-playercomponent-">Classe <em>PlayerComponent</em></h1>
<p>Ce composant représente le comportement d’un joueur.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlayerComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-3">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-3">&#182;</a>
                        </div>
                        <h2 id="m-thode-create-">Méthode <em>create</em></h2>
<p>Cette méthode est appelée pour configurer le composant avant
que tous les composants d’un objet aient été créés.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    create(descr) {
      <span class="hljs-keyword">this</span>.deadEvent = <span class="hljs-keyword">new</span> EventTrigger();

      <span class="hljs-keyword">this</span>.name = descr.name;
      <span class="hljs-keyword">this</span>.facing = <span class="hljs-string">'F'</span>;
      <span class="hljs-keyword">this</span>.prefix = descr.prefix;
      <span class="hljs-keyword">this</span>.gameArea = descr.gameArea;
      <span class="hljs-keyword">this</span>.isAttacking = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.isMoving = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.isDead = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.isHurt = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.isInvulnerable = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.invulnerableDuration = descr.invulnerableDuration;
      <span class="hljs-keyword">this</span>.hurtDuration = descr.hurtDuration;
      <span class="hljs-keyword">this</span>.hurtMotion = descr.hurtMotion;
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve();
    }</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-4">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-4">&#182;</a>
                        </div>
                        <h2 id="m-thode-setup-">Méthode <em>setup</em></h2>
<p>Cette méthode configure le composant. Elle crée une instance
de sprite, et y configure une fonction de rappel lorsque
l’animation d’attaque est terminée.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    setup(descr) {
      <span class="hljs-keyword">this</span>.input = <span class="hljs-keyword">this</span>.findComponent(descr.input);
      <span class="hljs-keyword">this</span>.spriteSheet = <span class="hljs-keyword">this</span>.findComponent(descr.spriteSheet);
      <span class="hljs-keyword">this</span>.score = <span class="hljs-keyword">this</span>.findComponent(descr.score);
      <span class="hljs-keyword">this</span>.life = <span class="hljs-keyword">this</span>.findComponent(descr.life);
      <span class="hljs-keyword">this</span>.life.deadEvent.add(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.onDead);
      <span class="hljs-keyword">this</span>.life.hurtEvent.add(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.onHurt);

      descr.onHurtEnable.forEach((item) =&gt; {
        <span class="hljs-keyword">const</span> component = <span class="hljs-keyword">this</span>.findComponent(item);
        <span class="hljs-keyword">this</span>.life.hurtEvent.add(<span class="hljs-keyword">this</span>, () =&gt; {
          component.enabled = <span class="hljs-literal">true</span>;
        });
      });

      <span class="hljs-keyword">this</span>.sprite = <span class="hljs-keyword">this</span>.owner.addComponent(<span class="hljs-string">'Sprite'</span>);
      <span class="hljs-keyword">const</span> spriteDescr = {
        spriteSheet: <span class="hljs-keyword">this</span>.spriteSheet,
      };
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sprite.create(spriteDescr)
        .then(() =&gt; {
          <span class="hljs-keyword">this</span>.sprite.animationEndedEvent.push(() =&gt; {
            <span class="hljs-keyword">this</span>.isAttacking = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">this</span>.sprite.frameSkip = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">this</span>.updateSprite();
            <span class="hljs-keyword">this</span>.sprite.updateMesh();
          });
          <span class="hljs-keyword">this</span>.updateSprite();
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sprite.setup(spriteDescr);
        })
        .then(() =&gt; {
          <span class="hljs-keyword">this</span>.sprite.__ready = <span class="hljs-literal">true</span>;
        });
    }</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-5">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-5">&#182;</a>
                        </div>
                        <h2 id="m-thode-ondead-">Méthode <em>onDead</em></h2>
<p>Déclenchée lorsque le joueur est mort</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    onDead() {
      <span class="hljs-keyword">this</span>.isDead = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">this</span>.deadEvent.trigger();
    }</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-6">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-6">&#182;</a>
                        </div>
                        <h2 id="m-thode-onhurt-">Méthode <em>onHurt</em></h2>
<p>Déclenchée lorsque le joueur est blessé</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    onHurt() {
      <span class="hljs-keyword">const</span> collider = <span class="hljs-keyword">this</span>.owner.getComponent(<span class="hljs-string">'Collider'</span>);

      <span class="hljs-keyword">this</span>.isHurt = <span class="hljs-literal">true</span>;
      setTimeout(() =&gt; {
        <span class="hljs-keyword">this</span>.isHurt = <span class="hljs-literal">false</span>;
      }, <span class="hljs-keyword">this</span>.hurtDuration);

      <span class="hljs-keyword">this</span>.isInvulnerable = <span class="hljs-literal">true</span>;
      collider.enabled = <span class="hljs-literal">false</span>;
      setTimeout(() =&gt; {
        <span class="hljs-keyword">this</span>.isInvulnerable = <span class="hljs-literal">false</span>;
        collider.enabled = <span class="hljs-literal">true</span>;
      }, <span class="hljs-keyword">this</span>.invulnerableDuration);
    }</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-7">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-7">&#182;</a>
                        </div>
                        <h2 id="m-thode-update-">Méthode <em>update</em></h2>
<p>Cette méthode récupère les entrées du joueur, effectue les
déplacements appropriés, déclenche l’état d’attaque et ajuste
la sprite du joueur.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    update(frame) {
      <span class="hljs-keyword">let</span> delta = <span class="hljs-literal">undefined</span>;
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isDead) {
        delta = <span class="hljs-keyword">this</span>.updateDead();
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isHurt) {
        delta = <span class="hljs-keyword">this</span>.updateHurt();
      } <span class="hljs-keyword">else</span> {
        delta = <span class="hljs-keyword">this</span>.updateStandard();
      }

      <span class="hljs-keyword">const</span> visible = (!<span class="hljs-keyword">this</span>.isInvulnerable) || (frame % <span class="hljs-number">2</span>);
      <span class="hljs-keyword">this</span>.sprite.enabled = visible;

      <span class="hljs-keyword">const</span> position = <span class="hljs-keyword">this</span>.owner.getComponent(<span class="hljs-string">'Position'</span>);
      vec3.scale(delta, delta, <span class="hljs-number">3</span>);
      position.translate(delta);
      position.clamp(<span class="hljs-keyword">this</span>.gameArea.x, <span class="hljs-keyword">this</span>.gameArea.x + <span class="hljs-keyword">this</span>.gameArea.w, <span class="hljs-keyword">this</span>.gameArea.y, <span class="hljs-keyword">this</span>.gameArea.y + <span class="hljs-keyword">this</span>.gameArea.h);
    }</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-8">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-8">&#182;</a>
                        </div>
                        <h2 id="m-thode-updatedead-">Méthode <em>updateDead</em></h2>
<p>Met à jour le joueur quand il est mort</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    updateDead() {
      <span class="hljs-keyword">this</span>.isMoving = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.isAttacking = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.sprite.isAnimated = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.sprite.spriteName = <span class="hljs-string">`<span class="hljs-subst">${this.prefix}</span>D`</span>;
      <span class="hljs-keyword">this</span>.sprite.updateMesh();

      <span class="hljs-keyword">const</span> collider = <span class="hljs-keyword">this</span>.owner.getComponent(<span class="hljs-string">'Collider'</span>);
      collider.enabled = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> vec3.create();
    }</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-9">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-9">&#182;</a>
                        </div>
                        <h2 id="m-thode-updatehurt-">Méthode <em>updateHurt</em></h2>
<p>Met à jour le joueur quand il est blessé</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    updateHurt() {
      <span class="hljs-keyword">this</span>.isMoving = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.isAttacking = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.sprite.isAnimated = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.sprite.spriteName = <span class="hljs-string">`<span class="hljs-subst">${this.prefix}</span>H<span class="hljs-subst">${this.facing}</span>`</span>;
      <span class="hljs-keyword">this</span>.sprite.updateMesh();

      <span class="hljs-keyword">const</span> delta = vec3.create();
      <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.facing) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'B'</span>:
          delta[<span class="hljs-number">1</span>] = <span class="hljs-keyword">this</span>.hurtMotion;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
          delta[<span class="hljs-number">1</span>] = -<span class="hljs-keyword">this</span>.hurtMotion;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'L'</span>:
          delta[<span class="hljs-number">0</span>] = <span class="hljs-keyword">this</span>.hurtMotion;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'R'</span>:
          delta[<span class="hljs-number">0</span>] = -<span class="hljs-keyword">this</span>.hurtMotion;
          <span class="hljs-keyword">break</span>;
      }
      <span class="hljs-keyword">return</span> delta;
    }</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-10">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-10">&#182;</a>
                        </div>
                        <h2 id="m-thode-updatestandard-">Méthode <em>updateStandard</em></h2>
<p>Met à jour le mouvement normal du joueur</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    updateStandard() {
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isAttacking &amp;&amp; <span class="hljs-keyword">this</span>.input.getKey(<span class="hljs-string">'attack'</span>)) {
        <span class="hljs-keyword">this</span>.isAttacking = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.sprite.animationFrame = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">this</span>.sprite.frameSkip = <span class="hljs-number">1</span>;
      }

      <span class="hljs-keyword">const</span> delta = vec3.create();

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.input.getKey(<span class="hljs-string">'up'</span>)) {
        delta[<span class="hljs-number">1</span>]--;
        <span class="hljs-keyword">this</span>.facing = <span class="hljs-string">'B'</span>;
      }
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.input.getKey(<span class="hljs-string">'down'</span>)) {
        delta[<span class="hljs-number">1</span>]++;
        <span class="hljs-keyword">this</span>.facing = <span class="hljs-string">'F'</span>;
      }
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.input.getKey(<span class="hljs-string">'left'</span>)) {
        delta[<span class="hljs-number">0</span>]--;
        <span class="hljs-keyword">this</span>.facing = <span class="hljs-string">'L'</span>;
      }
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.input.getKey(<span class="hljs-string">'right'</span>)) {
        delta[<span class="hljs-number">0</span>]++;
        <span class="hljs-keyword">this</span>.facing = <span class="hljs-string">'R'</span>;
      }

      <span class="hljs-keyword">this</span>.isMoving = vec3.length(delta) &gt; <span class="hljs-number">0</span>;

      <span class="hljs-keyword">this</span>.updateSprite();
      <span class="hljs-keyword">this</span>.sprite.updateMesh();

      <span class="hljs-keyword">return</span> delta;
    }</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-11">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-11">&#182;</a>
                        </div>
                        <h2 id="m-thode-updatesprite-">Méthode <em>updateSprite</em></h2>
<p>Choisi la sprite appropriée selon le contexte.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    updateSprite() {
      <span class="hljs-keyword">this</span>.sprite.isAnimated = <span class="hljs-keyword">this</span>.isMoving || <span class="hljs-keyword">this</span>.isAttacking;
      <span class="hljs-keyword">const</span> mod = <span class="hljs-keyword">this</span>.isAttacking ? <span class="hljs-string">'A'</span> : <span class="hljs-string">'M'</span>;
      <span class="hljs-keyword">const</span> frame = <span class="hljs-keyword">this</span>.sprite.isAnimated ? <span class="hljs-string">''</span> : <span class="hljs-string">'1'</span>;

      <span class="hljs-keyword">this</span>.sprite.spriteName = <span class="hljs-string">`<span class="hljs-subst">${this.prefix}</span><span class="hljs-subst">${mod}</span><span class="hljs-subst">${this.facing}</span><span class="hljs-subst">${frame}</span>`</span>;
    }</pre></div>
                      </div>
                      
                  </li>
                  
                
                  <li id="section-12">
                    <div class="annotation">
                      
                        <div class="pilwrap ">
                          <a class="pilcrow" href="#section-12">&#182;</a>
                        </div>
                        <h2 id="m-thode-oncollision-">Méthode <em>onCollision</em></h2>
<p>Cette méthode est appelée par le <em>CollisionComponent</em>
lorsqu’il y a collision entre le joueur et un objet pertinent.
Si cet objet est un rubis, on le récupère et on incrémente
le score, si c’est un poulet, on le détruit si on est en
état d’attaque, sinon on soustrait le score et on désactive
ce poulet.</p>

                    </div>
                    
                      <div class="content">
                        <div class='highlight'><pre>    onCollision(otherCollider) {
      <span class="hljs-keyword">const</span> obj = otherCollider.owner;
      <span class="hljs-keyword">const</span> rupee = obj.getComponent(<span class="hljs-string">'Rupee'</span>);
      <span class="hljs-keyword">const</span> heart = obj.getComponent(<span class="hljs-string">'Heart'</span>);
      <span class="hljs-keyword">const</span> chicken = obj.getComponent(<span class="hljs-string">'Chicken'</span>);

      <span class="hljs-keyword">if</span> (rupee) {
        <span class="hljs-keyword">this</span>.score.value += rupee.value;
        obj.active = <span class="hljs-literal">false</span>;
        obj.parent.removeChild(obj);
      }
      <span class="hljs-keyword">if</span> (heart) {
        <span class="hljs-keyword">this</span>.life.value += heart.heal;
        obj.active = <span class="hljs-literal">false</span>;
        obj.parent.removeChild(obj);
      }
      <span class="hljs-keyword">if</span> (chicken) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isAttacking) {
          chicken.onAttack();
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">this</span>.life.value -= chicken.attack;
        }
      }
    }
  }

  <span class="hljs-keyword">return</span> PlayerComponent;
});</pre></div>
                      </div>
                      
                  </li>
                  
        </ul>
        </div>
</body>

</html>
